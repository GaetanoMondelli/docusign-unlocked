{
  "procedureTemplates": [
    {
      "templateId": "hiring_process",
      "name": "Software Engineer Hiring Process",
      "description": "Standard hiring workflow for software engineering positions",
      "variables": {
        "candidate": {
          "email": { "type": "string", "required": true },
          "name": { "type": "string", "required": true }
        },
        "company": {
          "email": { "type": "string", "required": true },
          "department": { "type": "string", "required": true }
        }
      },
      "eventTypes": [
        {
          "type": "EMAIL_RECEIVED",
          "schema": {
            "from": "string",
            "to": "string",
            "subject": "string",
            "body": "string",
            "time": "string"
          }
        },
        {
          "type": "DOCUMENT_UPLOADED",
          "schema": {
            "filename": "string",
            "type": "string",
            "url": "string"
          }
        }
      ],
      "messageRules": [
        {
          "id": "interview_request_pattern",
          "priority": 1,
          "matches": {
            "type": "EMAIL_RECEIVED",
            "conditions": {
              "from": "{{candidate.email}}",
              "to": "{{company.email}}",
              "subject": "(contains) interview",
              "time": "{{event.data.time}}"
            }
          },
          "generates": {
            "type": "contact_candidate",
            "template": {
              "title": "Interview requested by {{candidate.name}}",
              "content": "Candidate has requested an interview for {{company.department}} position",
              "timestamp": "{{event.data.time}}"
            }
          }
        },
        {
          "id": "interview_request_llm",
          "priority": 2,
          "matches": {
            "type": "EMAIL_RECEIVED",
            "conditions": {
              "from": "{{candidate.email}}",
              "to": "{{company.email}}",
              "body": "(llm-prompt) {{candidate.name}} asks for an interview",
              "time": "{{event.data.time}}"
            }
          },
          "generates": {
            "type": "discuss_role",
            "template": {
              "title": "Interview requested by {{candidate.name}}",
              "content": "Candidate has requested an interview for {{company.department}} position",
              "timestamp": "{{event.data.time}}"
            }
          }
        }
      ],
      "stateMachine": {
        "fsl": "idle 'contact_candidate' -> contacting_candidate; contacting_candidate 'discuss_role' -> role_discussed; role_discussed 'schedule_interview' -> interview_scheduled; interview_scheduled 'conduct_interview' -> interview_conducted; interview_conducted 'positive_feedback' -> offer_preparation; interview_conducted 'negative_feedback' -> failure; offer_preparation 'set_tabs_for_contract' -> contract_prepared; contract_prepared 'send_contract' -> contract_sent; contract_sent 'wait_for_signature' -> contract_signed; contract_sent 'rejection' -> failure; contract_signed 'check_lifecycle' -> onboarding_started; onboarding_started 'complete_training' -> training_completed; training_completed 'probation_period' -> probation_review; probation_review 'positive_feedback' -> salary_review; probation_review 'negative_feedback' -> termination_initiated; salary_review 'positive_feedback' -> performance_review; salary_review 'negative_feedback' -> termination_initiated; performance_review 'positive_feedback' -> active_employee; performance_review 'negative_feedback' -> termination_initiated; active_employee 'request_to_leave' -> voluntary_exit; active_employee 'termination_decision' -> termination_initiated; termination_initiated 'finalize' -> terminated; voluntary_exit 'finalize' -> exited; failure 'retry' -> idle;"
      },
      "actions": {
        "interview_requested": [
          {
            "type": "SEND_EMAIL",
            "template": {
              "from": "{{company.email}}",
              "to": "{{candidate.email}}",
              "subject": "Interview Request Received for {{company.department}}",
              "body": "Dear {{candidate.name}},\n\nWe received your interview request for the position in {{company.department}}.\n\nBest regards,\nHR Team"
            }
          },
          {
            "type": "CREATE_CALENDAR_EVENT",
            "template": {
              "title": "Interview with {{candidate.name}}",
              "description": "Interview for {{company.department}} position",
              "attendees": ["{{candidate.email}}", "{{company.email}}"]
            }
          }
        ],
        "interview_scheduled": [
          {
            "type": "SEND_REMINDER",
            "template": {
              "to": "{{candidate.email}}",
              "subject": "Interview Reminder",
              "body": "Dear {{candidate.name}},\n\nThis is a reminder about your upcoming interview..."
            }
          }
        ]
      }
    }
  ],
  "procedureInstances": [
    {
      "instanceId": "proc_123",
      "templateId": "hiring_process",
      "variables": {
        "candidate": {
          "email": "john@example.com",
          "name": "John Doe"
        },
        "company": {
          "email": "hr@company.com",
          "department": "Engineering"
        }
      },
      "currentState": "interview_requested",
      "events": [
        {
          "id": "evt_1",
          "type": "EMAIL_RECEIVED",
          "timestamp": "2024-03-20T10:00:00Z",
          "data": {
            "from": "john@example.com",
            "to": "hr@company.com",
            "subject": "Interview request",
            "body": "I'd like to schedule an interview",
            "time": "2024-03-20T09:58:00Z"
          }
        }
      ],
      "messages": [
        {
          "id": "msg_1",
          "type": "contact_candidate",
          "timestamp": "2024-03-20T09:58:00Z",
          "title": "Interview requested by John Doe",
          "content": "Candidate has requested an interview for Engineering position",
          "fromEvent": "evt_1"
        },
        {
          "id": "msg_2",
          "type": "discuss_role",
          "timestamp": "2024-03-20T10:00:01Z",
          "title": "Interview requested by John Doe",
          "content": "Candidate has requested an interview for Engineering position",
          "fromEvent": "evt_1"
        }
      ],
      "completedActions": [
        {
          "id": "act_1",
          "type": "SEND_EMAIL",
          "timestamp": "2024-03-20T10:00:02Z",
          "result": {
            "success": true,
            "data": {
              "from": "hr@company.com",
              "to": "john@example.com",
              "subject": "Interview Request Received for Engineering",
              "messageId": "msg_123"
            }
          }
        }
      ]
    }
  ]
}
  